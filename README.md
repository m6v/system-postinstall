# Плейбук для постинсталляционной настройки Astra Linux SE 1.7, установки и настройки средств защиты информации

## Предварительные действия на конфигурируемых хостах

1) Отключение политики запрета установки бита исполнения, иначе использование ansible становится невозможным
```
astra-nochmodx-lock disable
```
2) Копирование репозиториев с установочного диска на конфигурируемые хосты, чтобы установка пакетов не требовала CD/DVD-дисков

## Подготовка и запуск плейбука

1) Копирование открытого ключа в домашний каталог администратора удаленного хоста
```
ssh-copy-id astra-admin@remote_host
```
2) Запуск плейбука
```
ansible-playbook -i hosts main.yml --ask-become-pass
```

## Создание структуры каталогов для роли

```
cd role_dir
mkdir defaults files handlers meta tasks templates vars
```

Назначение каталогов:
- **defaults** позволяет устанавливать переменные по умолчанию для включенных или зависимых ролей;
- **files** содержит статические файлы и файлы сценариев, которые могут быть скопированы на удалённый сервер или выполнены на нём;
- **handlers** все обработчики, которые ранее были в вашем плейбуке, теперь могут быть добавлены в каталог;
- **meta** для метаданных роли, которые используются для управления зависимостями, например, список ролей, которые должны быть применены до вызова текущей роли;
- **templates** для шаблонов, которые генерируют файлы на удалённых хостах;
- **tasks** содержит один или несколько файлов с задачами, которые определяются в разделе tasks обычного плейбука Ansible, эти задачи могут напрямую ссылаться на файлы и шаблоны, содержащиеся в соответствующих каталогах внутри роли, без необходимости указывать полный путь к файлу;
- **vars** переменные для роли могут быть указаны в файлах внутри каталога, а затем ссылаться на них в другом месте роли.

## Получение ip-адресов конфигурируемых хостов
ip-адреса конфигурируемых хостов можно получить из инвентори
{{ hostvars['arm-abi']['ansible_host'] }}
или по результатам сбора фактов (facts)
{{ hostvars[ 'arm-abi' ].ansible_default_ipv4.address }} # адрес дефолтного интерфейса
{{ hostvars[ 'arm-abi' ].ansible_eth0.ipv4.address }}" # адрес нулевого интерфейса
{{ hostvars[ 'arm-abi' ].ansible_eth1.ipv4.address }}" # адрес первого интерфейса и т.д.
